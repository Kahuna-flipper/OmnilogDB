{% extends 'base.html' %}

{% block head %}

<style>

.dtableforstrain{
        margin-left:250px;
    }
.dtprojectforstrain{
        margin-left:1000px;
        margin-right: 100px;
        height:50px;
        margin-top: 200px;
        width: 100px;
        
    }

#project_id.dataTable tbody tr:hover {
    background-color: lightgrey;
    }

#table_id.dataTable tbody tr:hover {
    background-color: lightgrey;
    }


#container {
    float:left;
    height: 200px;
    margin-left: 210px;
    margin-bottom:70px;
}

.highcharts-figure,
.highcharts-data-table table {
    min-width: 360px;
    max-width: 800px;
    margin: 1em auto;
}

.highcharts-data-table table {
    font-family: Verdana, sans-serif;
    border-collapse: collapse;
    border: 1px solid #ebebeb;
    margin: 10px auto;
    text-align: center;
    width: 100%;
    max-width: 500px;
}

.highcharts-data-table caption {
    padding: 1em 0;
    font-size: 1.2em;
    color: #555;
}

.highcharts-data-table th {
    font-weight: 600;
    padding: 0.5em;
}

.highcharts-data-table td,
.highcharts-data-table th,
.highcharts-data-table caption {
    padding: 0.5em;
}

.highcharts-data-table thead tr,
.highcharts-data-table tr:nth-child(even) {
    background: #f8f8f8;
}

.highcharts-data-table tr:hover {
    background: #f1f7ff;
}
</style>

{% endblock %}




{% block body %}

<div id="container" class="chart" style="height: 500px; width: 800px"></div>

<div class = "dprojectforstrain" style="margin-left: 210px;width:1600px;margin-top: 300px;">
    <table id="table_id" class ="table table-hover">
        <thead class="thead-light">        
            <tr>
                <th>PlateID</th>
                <th>Plate</th>
                <th>Well</th>
                <th>Compound</th>
                <th>Max Respiration</th>
                <th>Max Respiration Rate</th>
                <th>Time till max resp rate(hrs)</th>
                <th>AUC</th>
                <th>Z-Score(wrt controls)</th>
                <th>Growth(1)/No Growth(0)/Uncertain(0.5)</th>
                <th>KEGG ID</th>
                <th>CAS ID</th>
            </tr>
        </thead>
    </table>
    
    </div>

<script>
    var chart_id = {{ chartID|safe}}
    var title = {{ title|safe}}
    var chart = {{ chart|safe}}
    var xAxis = {{ xAxis|safe}}
    var yAxis = {{ yAxis|safe}}
    var data = {{ data|safe}}


</script> 

<script src="https://code.highcharts.com/10.3.3/highcharts.js"></script>
<script src="https://code.highcharts.com/10.3.3/modules/heatmap.js"></script>
<script src="https://code.highcharts.com/10.3.3/modules/exporting.js"></script>
<script src="https://code.highcharts.com/10.3.3/modules/export-data.js"></script>
<script src="https://code.highcharts.com/10.3.3/modules/accessibility.js"></script>

{% endblock %}

{% block script%}

<script>

function getPointCategoryName(point, dimension) {
    var series = point.series,
        isY = dimension === 'y',
        axis = series[isY ? 'yAxis' : 'xAxis'];
    return axis.categories[point[isY ? 'y' : 'x']];
}

Highcharts.chart('container',{
          chart: chart,
          title: title,
          xAxis: xAxis,
          yAxis: yAxis,
          accessibility: {
                point: {
                    descriptionFormatter: function (point) {
                        var ix = point.index + 1,
                            xName = getPointCategoryName(point, 'x'),
                            yName = getPointCategoryName(point, 'y'),
                            val = point.value;
                        return ix + '. ' + xName + ' sales ' + yName + ', ' + val + '.';
                    }
                }
            },
        colorAxis: {
                min: 0,
                stops:[[0,'#FFFFFF'],[0.5,'#cc819d'],[1,'#cb9be8']],
                minColor: '#FFFFFF',
                maxColor : '#cb9be8',
                // maxColor: Highcharts.getOptions().colors[0]
            },

        tooltip: {
                formatter: function () {
                    if(this.point.value==1){
                        return '<b>'+ getPointCategoryName(this.point, 'y')+'</b>'+getPointCategoryName(this.point, 'x')+'</b> Growth : Yes';
                    }
                    else if(this.point.value==0){
                        return '<b>'+ getPointCategoryName(this.point, 'y')+'</b>'+getPointCategoryName(this.point, 'x')+'</b> Growth : No';

                    }
                    else{
                        return '<b>'+ getPointCategoryName(this.point, 'y')+'</b>'+getPointCategoryName(this.point, 'x')+'</b> Growth : Uncertain';
                    }
                    // return '<b>' + getPointCategoryName(this.point, 'x') + '</b> sold <br><b>' +
                    //     this.point.value + '</b> items on <br><b>' + getPointCategoryName(this.point, 'y') + '</b>';
                }
            },

        plotOptions: {
        heatmap: {
            dataLabels: {
                enabled: false
            }
        }
    },

    series: [{
        name: 'Growth(1)/No Growth(0)/Uncertain(0.5)',
        borderWidth: 2.5,
        data: data,
        borderColor:'#0a000f',
        dataLabels: {
            enabled: false,
            color: '#000000'
        }
    }],

        responsive: {
            rules: [{
                condition: {
                    maxWidth: 500
                },
                chartOptions: {
                    yAxis: {
                        labels: {
                            formatter: function () {
                                return this.value.charAt(0);
                            }
                        }
                    }
                }
            }]
        }
      });

$(document).ready(function() {
        var table = $('#table_id').DataTable( {
            //"ajax": '/strains/json',
            "ajax":'/strain_kinetics/json',
            "lengthChange": true,
            "deferRender": true,
            "info": true,
            "lengthMenu": [[10, 50, 80, -1], [10, 50, 80, "All"]],
        } );

        $('#table_id').on('click', 'tr', function() {
            console.log('API row values : ', table.row(this).data());
        
        })
    } );
</script>

{%endblock%}